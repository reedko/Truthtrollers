(async()=>{const e=new URLSearchParams(location.search).get("src");if(!e)return;try{await browser.runtime.sendMessage({action:"setViewedUrlFromViewer",url:e})}catch(e){console.warn("Failed to setViewedUrlFromViewer:",e)}const t=`http://localhost:3000/api/proxy-pdf?url=${encodeURIComponent(e)}`;try{const e=await fetch(t,{redirect:"follow"});if(!e.ok)throw new Error(`proxy failed ${e.status}`);const r=await e.arrayBuffer();if(!r.byteLength)throw new Error("empty PDF");const o=URL.createObjectURL(new Blob([r],{type:"application/pdf"}));document.getElementById("pdf").src=o}catch(e){console.error("PDF load error:",e),document.getElementById("wrap").textContent="Failed to display PDF (see console)."}})();